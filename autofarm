local LocalPlayer = game:GetService("Players").LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")

game:GetService("Workspace").Balls.ChildAdded:Connect(function(child)
    local trackTask = task.spawn(function()
        local ball = child
        while task.wait() do
            if string.find(ball.BrickColor.Name:lower(), "red") then
                print("Found parry target")
                local distance = LocalPlayer:DistanceFromCharacter(ball.Position)

                if distance > getgenv().ScriptConfig.LongDistanceParry then
                    -- Long-distance parry logic
                    print("Long-distance Parrying...")
                    ReplicatedStorage.Remotes.ParryButtonPress:Fire()
                    print("Parry attempted")
                elseif distance > getgenv().ScriptConfig.ShortDistanceParry then
                    -- Short-distance parry logic
                    print("Short-distance Parrying...")
                    ReplicatedStorage.Remotes.ParryButtonPress:Fire()
                    print("Parry attempted")
                end

                -- Wait for the ball to be destroyed
                ball.AncestryChanged:Wait()

                -- Create the visual cube at the ball's position for 1 second
                local cube = Instance.new("Part")
                cube.Anchored = true
                cube.Size = Vector3.new(5, 5, 5) -- Adjust the size of the cube as needed
                cube.BrickColor = BrickColor.new("Bright red")
                cube.Transparency = 0.5 -- Adjust the transparency as needed
                cube.CanCollide = false
                cube.Position = ball.Position
                cube.Parent = game.Workspace
                wait(1)
                cube:Destroy() -- Destroy the cube after 1 second
            end
        end
    end)

    child.Destroying:Connect(function()
        task.cancel(trackTask)
    end)
end)
